// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

// Limpar qualquer sess√£o antiga de projetos anteriores
const cleanOldSessions = () => {
  const keysToRemove = [];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key && (key.includes('racfoelvuhdifnekjsro') || key.includes('supabase.auth.token'))) {
      keysToRemove.push(key);
    }
  }
  keysToRemove.forEach(key => localStorage.removeItem(key));
  console.log('üßπ Limpeza de sess√µes antigas conclu√≠da');
};

// Executar limpeza na inicializa√ß√£o
cleanOldSessions();

import { supabase as supabaseConfig } from '@/config/environment';

const SUPABASE_URL = supabaseConfig.url;
const SUPABASE_PUBLISHABLE_KEY = supabaseConfig.anonKey;

// Testar conectividade do projeto (apenas em desenvolvimento)
const testConnectivity = async () => {
  if (supabaseConfig.isProduction) return; // N√£o executar em produ√ß√£o
  
  try {
    console.log('üîç Testando conectividade com Supabase...');

    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10s timeout

    const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {
      method: 'HEAD',
      headers: {
        'apikey': SUPABASE_PUBLISHABLE_KEY,
      },
      signal: controller.signal,
    });

    clearTimeout(timeoutId);

    if (response.ok) {
      console.log('‚úÖ Conectividade Supabase OK - Projeto ativo');
      return true;
    } else {
      console.warn('‚ö†Ô∏è Resposta Supabase inesperada:', response.status);
      return false;
    }
  } catch (error) {
    if (error.name === 'AbortError') {
      console.error('‚è±Ô∏è Timeout na conex√£o Supabase - Projeto pode estar sendo restaurado');
    } else if (error.message.includes('ERR_NAME_NOT_RESOLVED')) {
      console.error('üåê DNS n√£o resolve - Projeto pode estar pausado ou sendo restaurado');
      console.log('üí° Aguarde alguns minutos e tente novamente');
    } else {
      console.error('‚ùå Erro de conectividade Supabase:', error.message);
    }
    return false;
  }
};

// Executar teste de conectividade apenas em desenvolvimento
if (supabaseConfig.isDevelopment) {
  testConnectivity();
}

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
  auth: {
    storage: localStorage,
    persistSession: true,
    autoRefreshToken: true,
    storageKey: 'vtyrpodosmhnyendcrjf-auth-token', // Chave √∫nica para evitar conflitos
  }
});